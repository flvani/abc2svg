// abc2svg - ABC to SVG translator
// Copyright (C) 2014-2015 Jean-Francois Moine
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License version 2 as
// published by the Free Software Foundation.
// abcemb.js for abc2svg-1.4.1 (2015-10-26)
var errtxt="",new_page="",abc;function User(){this.read_file=function(fn){return readFile(fn)};this.errmsg=function(msg,l,c){errtxt+=msg+"\n"};this.img_out=function(str){new_page+=str};this.page_format=true}var user=new User;function debug(){var i,tmp="debug:";for(i=0;i<arguments.length;i++)tmp+=" "+arguments[i];errtxt+=tmp+"\n"}function dom_loaded(){var page=document.body.innerHTML;var i=0,j,k,res,re=/\n%abc|\nX:/g,re_stop=/\n<|\n%.begin/g;abc=new Abc(user);for(;;){res=re.exec(page);if(!res)break;j=re.lastIndex-res[0].length;new_page+=page.slice(i,j);re_stop.lastIndex=j;while(1){res=re_stop.exec(page);if(!res||res[0]=="\n<")break;k=page.indexOf(res[0].replace("begin","end"),re_stop.lastIndex);if(k<0)break;re_stop.lastIndex=k}if(!res||k<0)k=page.length;else k=re_stop.lastIndex-2;try{abc.tosvg("abcemb",page.slice(j+1,k))}catch(e){alert("abc2svg javascript error: "+e.message+"\nStack:\n"+e.stack)}if(errtxt){i=page.indexOf("\n",j+1);i=page.indexOf("\n",i+1);alert("Errors in\n"+page.slice(j+1,i)+"\n...\n\n"+errtxt);errtxt=""}i=k;if(k>=page.length)break;re.lastIndex=i}try{document.body.innerHTML=new_page+page.slice(i)}catch(e){alert("abc2svg bad generated SVG: "+e.message+"\nStack:\n"+e.stack)}}document.addEventListener("DOMContentLoaded",dom_loaded,false);